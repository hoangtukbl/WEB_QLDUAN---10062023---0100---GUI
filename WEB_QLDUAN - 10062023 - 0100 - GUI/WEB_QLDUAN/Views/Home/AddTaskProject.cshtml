@{
    ViewBag.Title = "Quản lý dự án";
    Layout = "~/Views/Shared/_Site.cshtml";
    @model WEB_QLDUAN.Models.Project
}

@section Styles{

    <link rel="stylesheet" href="~/Content/adminlte/components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/components/Ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/dist/css/skins/skin-blue.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <link rel="stylesheet" href="~/Content/adminlte/components/select2/dist/css/select2.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="~/Content/adminlte/dist/css/AdminLTE.css">
    <link href="~/tra-cuu/Content/Customer.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/adminlte/components/datatables.net-bs/css/dataTables.bootstrap.min.css">

    <link href="~/tra-cuu/Content/Libs/jquery-ui-1.9.1.custom.css" rel="stylesheet">
    @*<link href="~/tra-cuu/Content/DefaultPartial.css" rel="stylesheet">*@
    <link href="~/Content/dhtmlxgantt.css" rel="stylesheet" />
    <link href="~/Content/controls_styles.css" rel="stylesheet" />

    <style>
        .myborderError {
            border: solid 1px red !important;
        }

        ::-webkit-input-placeholder { /* Chrome */
            color: green;
            transition: opacity 250ms ease-in-out;
            font-size: 12px;
            font-weight: 100;
            font-style: italic;
        }

        :focus::-webkit-input-placeholder {
            opacity: 0.5;
            font-size: 10px;
        }

        :-ms-input-placeholder { /* IE 10+ */
            color: red;
            transition: opacity 250ms ease-in-out;
        }

        :focus:-ms-input-placeholder {
            opacity: 0.5;
            font-size: 9px;
        }

        ::-moz-placeholder { /* Firefox 19+ */
            color: #ccc;
            opacity: 0.3;
            transition: opacity 250ms ease-in-out;
            font-size: 12px;
            font-weight: 100;
            font-style: italic;
        }

        :focus::-moz-placeholder {
            opacity: 0.5;
        }

        :-moz-placeholder { /* Firefox 4 - 18 */
            color: red;
            opacity: 1;
            transition: opacity 250ms ease-in-out;
        }

        :focus:-moz-placeholder {
            opacity: 0.5;
            font-size: 10px;
        }

        .modalLoading {
            position: fixed;
            z-index: 999;
            height: 100%;
            width: 82%;
            top: 0;
            /*background-color: Black;
                    filter: alpha(opacity=30);
                    opacity: 0.2;*/
            -moz-opacity: 0.8;
        }

        .centerLoading {
            z-index: 1000;
            margin: 300px auto;
            padding: 8px;
            width: 60px;
            background-color: #d3cccc;
            border-radius: 5px;
            filter: alpha(opacity=100);
            opacity: 1;
            -moz-opacity: 1;
            text-align: center;
            color: orangered;
            opacity: 0.8;
        }

            .centerLoading img {
                text-align: center;
            }

        .nav-list li.active > a:after {
            border-right-color: #000000;
        }

        .breadcrumb > li + li:before {
            display: none;
        }

        .btn-cauhoi {
            background-color: #c2fbd7;
            border-radius: 100px;
            box-shadow: rgba(44, 187, 99, .2) 0 -25px 18px -14px inset,rgba(44, 187, 99, .15) 0 1px 2px,rgba(44, 187, 99, .15) 0 2px 4px,rgba(44, 187, 99, .15) 0 4px 8px,rgba(44, 187, 99, .15) 0 8px 16px,rgba(44, 187, 99, .15) 0 16px 32px;
            color: green;
            cursor: pointer;
            display: inline-block;
            font-family: CerebriSans-Regular,-apple-system,system-ui,Roboto,sans-serif;
            padding: 7px 20px;
            text-align: center;
            text-decoration: none;
            transition: all 250ms;
            border: 0;
            font-size: 16px;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

            .btn-cauhoi:hover {
                box-shadow: rgba(44,187,99,.35) 0 -25px 18px -14px inset,rgba(44,187,99,.25) 0 1px 2px,rgba(44,187,99,.25) 0 2px 4px,rgba(44,187,99,.25) 0 4px 8px,rgba(44,187,99,.25) 0 8px 16px,rgba(44,187,99,.25) 0 16px 32px;
                transform: scale(1.05) rotate(-1deg);
            }

        .table-header {
            background-color: #438eb9 !important;
        }

        #btn-scroll-up {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: transparent !important;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 10px;
        }

            #btn-scroll-up :hover {
                background-color: #555;
            }

        #dtCauHoiThemMoi_wrapper .row:first-child {
            display: none;
        }

        #dtCauHoiThemMoi_wrapper .row:last-child {
            display: none;
        }

        #dtCauHoiCapNhat_wrapper .row:first-child {
            display: none;
        }

        #dtCauHoiCapNhat_wrapper .row:last-child {
            display: none;
        }

        .validation-summary-errors {
            font-size: 14px;
            /*margin-top: 15px;*/
            color: red;
        }

        .glyphicon.fast-right-spinner {
            -webkit-animation: glyphicon-spin-r 1s infinite linear;
            animation: glyphicon-spin-r 1s infinite linear;
        }

        .sidebar::before {
            background: #585858 !important;
        }

        .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
            color: #576373;
            border-color: #c5d0dc;
            border-top: 2px solid #4c8fbd;
            border-bottom-color: transparent;
            background-color: #FFF;
            z-index: 12;
            line-height: 16px;
            margin-top: -1px;
            box-shadow: 0 -2px 3px 0 rgba(0,0,0,0.15);
        }

        .green {
            color: #69aa46 !important;
        }

        .table-header {
            background-color: #307ecc;
            color: #FFF;
            font-size: 14px;
            line-height: 38px;
            padding-left: 12px;
            margin-bottom: 5px;
        }

        .pagination > li > a, .pagination > li > span {
            float: none;
        }

        .dataTables_length > label {
            font-size: 13px;
            font-weight: normal;
        }

        .dataTables_filter > label {
            font-size: 13px;
            font-weight: normal;
        }

        .dataTables_info {
            font-size: 13px;
        }
    </style>
}

<div class="content-wrapper" style="">
    <div class="row" style="margin-bottom:15px; margin-right:10px;">
        <section class="content-header">
            <h3 class="" style="color: #dd4b39; margin-top:5px; margin-bottom:3px; display:none;">
                Project Management
                <small>#@Session["Login"]</small>
                <i id="TongHop_Loading" class="fa fa-spinner fa-spin fa-3x fa-fw" style="font-size:18px; display:none;"></i>
                <span id="isMobile"></span>
            </h3>
            <ol class="breadcrumb">
                <li>
                    <a href="javascript:void(0);" onclick="location.href='/Home/Index/'">
                        <i class=" fa fa-dashboard"></i> Home >
                    </a>
                </li>
                <li class="active">Tasks Project</li>
            </ol>
        </section>
    </div>

    <section class="content" style="margin-top:0px;">
        <div class="row">
            <div class="col-md-12">
                <div class="box box-warning" id="boxTitle" style="border-top-width:2px; background-color:#fafffa" @*style="font-family: Helvetica Neue,Helvetica,Arial,sans-serif;"*@>
                    <div class="box-header with-border" style="">
                        <i class="fa fa-plus" id="iconTitle" style="color:darkorange"></i>
                        <h4 class="box-title" style="font-family: Helvetica Neue,Helvetica,Arial,sans-serif; font-size:16px;"><strong id="txtTitle" style="color:darkorange">Tasks of Project</strong></h4>
                        <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                <i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="box-body">
                        @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "frmInsertProject" }))
                        {
                            @*@Html.AntiForgeryToken();*@
                            <input type="hidden" id="Owner" name="Owner" value="@Model.Owner" />
                            <input type="hidden" id="UserLogin" name="UserLogin" value="@Session["Login"]" />

                            <div class="row">
                                <div class="col-md-12" style="">
                                    <div class="col-md-4">
                                        <label>Project ID:</label>
                                        <input id="ProjectID" style="font-weight:bold; color:red; background-color:#ffe6b7 !important;" class="form-control" placeholder="Project ID" value="@Model.ID" disabled />
                                    </div>
                                    <div class="col-md-4">
                                        <label>Project Name:</label>
                                        <input id="ProjectName" class="form-control" placeholder="Name" value="@Model.ProjectName" disabled />
                                    </div>
                                    <div class="col-md-4">
                                        <label>Owner:</label>
                                        <select id="lstOwner" class="form-control select2" style="width: 100%;" disabled></select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" style="margin-top:5px;">
                                    <div class="col-md-4">
                                        <label>Start date:</label>
                                        <input type="datetime" id="StartDate" name="StartDate" class="form-control" placeholder="dd/MM/yyyy" value="@Model.StartDate" disabled />
                                    </div>
                                    <div class="col-md-4">
                                        <label>End date:</label>
                                        <input type="datetime" id="FinishDate" name="FinishDate" class="form-control" placeholder="dd/MM/yyyy" value="@Model.EndDate" disabled />
                                    </div>
                                    <div class="col-md-4">
                                        <label>Count of Users:</label>
                                        <input id="Quantity" type="number" class="form-control" placeholder="Quantity" value="@Model.Quantity" disabled />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" style="margin-top:5px;">
                                    <div class="col-md-12">
                                        <label>Description:</label>
                                        <textarea id="Description" class="form-control" placeholder="Description" disabled>@Model.Description</textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12" style="margin-top:5px;">
                                    <hr style="margin:5px; margin-bottom:5px;" />
                                    <div class="col-md-12" style="">
                                        <label>Members:</label>@*<span><a href="#"><img src="~/tra-cuu/Content/image/addicon5.png" class="direct-chat-img right" style="float:none; width:60px; height:60px;" alt="User Image" /></a></span>*@
                                        @*<div style="display:inline">*@
                                        @*<img class="direct-chat-img" style="float:none; width:30px; height:30px;" src="~/Content/adminlte/dist/img/user1-128x128.jpg" alt="User Image">
                        <img class="direct-chat-img" style="float:none; width:30px; height:30px;" src="~/Content/adminlte/dist/img/user1-128x128.jpg" alt="User Image">
                        <img class="direct-chat-img" style="float:none; width:30px; height:30px;" src="~/Content/adminlte/dist/img/user1-128x128.jpg" alt="User Image">
                        <img class="direct-chat-img" style="float:none; width:30px; height:30px;" src="~/Content/adminlte/dist/img/user1-128x128.jpg" alt="User Image">
                        <img class="direct-chat-img" style="float:none; width:30px; height:30px;" src="~/Content/adminlte/dist/img/user1-128x128.jpg" alt="User Image">*@
                                        @*</div>*@
                                        <select id="lstUser" class="form-control select2" style="width: 100%;" multiple="multiple" disabled></select>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="display:none;">
                                <div class="col-md-12" style="margin-top:5px;">
                                    <hr style="margin-top:15px; margin-bottom:5px; margin-top:5px;" />
                                    <div class="col-md-12" style="">
                                        <label>Progress: <a id="btnAddTask" href="javascript:void(0)"><i class="fa fa-plus-circle"></i> Add Task</a></label>
                                        <table id="tblTask" class="table table-bordered table-striped">
                                            <thead>
                                                <tr>
                                                    <th style="width:30px;">STT</th>
                                                    <th style="min-width:90px;">Task ID</th>
                                                    <th class="col-md-3">Task name</th>
                                                    <th class="col-md-3">Start date</th>
                                                    <th class="col-md-1">Duration</th>
                                                    <th class="col-md-2">Owner</th>
                                                    <th class="col-md-1">ParentID</th>
                                                    <th class="col-md-1">LinkID</th>
                                                </tr>
                                            </thead>
                                            <tbody id="bodyTaskProject">
                                                @{
                                                    var stt = 0;
                                                }
                                                @for (int i = 0; i < 5; i++)
                                                {
                                                    stt += 1;
                                                    <tr>
                                                        <td class="" style="width:30px;">
                                                            @stt
                                                        </td>
                                                        <td style="min-width:90px;">
                                                            <input name="IDTask" style="font-weight:bold" class="form-control" />
                                                        </td>
                                                        <td class="col-md-3">
                                                            <input name="NameTask" style="text-transform: uppercase" class="form-control" />
                                                        </td>
                                                        <td class="col-md-3">
                                                            <div class="input-group date">
                                                                <div class="input-group-addon">
                                                                    <i class="fa fa-calendar"></i>
                                                                </div>
                                                                <input type="datetime" name="" class="form-control StartDateTask" placeholder="dd/MM/yyyy" />
                                                            </div>
                                                        </td>
                                                        <td class="col-md-1">
                                                            <input name="DurationTask" type="number" class="form-control" />
                                                        </td>
                                                        <td class="col-md-2">
                                                            <select name="" class="form-control lstOwnerTask" style="width: 100%;" multiple="multiple"></select>
                                                        </td>
                                                        <td class="col-md-1">
                                                            <input name="ParentIDTask" class="form-control" />
                                                        </td>
                                                        <td class="col-md-1">
                                                            <input name="LinkIDTask" class="form-control" />
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                            <tfoot>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12" style="margin-top:15px;">
                                    <div class="gantt_control" style="background: #f9e6c2; border: solid 1px #f5d08a;">
                                        <div class="filters_wrapper" id="filters_wrapper" style="color:blue">
                                            <i class="fa fa-tasks"></i><span style="font-family:Tahoma; font-size:14px; color:blue;"> Gantt chart: Task of Project</span>
                                        </div>
                                    </div>
                                    <div id="gantt_here"></div>
                                    <div id="Summary">

                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="box-footer" style="display:none;">
                        <div class="row pull-right" style="margin-right:5px;">
                            <div class="col-md-12">
                                <button id="btnInsertProject" data-id="insert" type="button" class="btn btn-primary">
                                    Save
                                    <i id="InsertProjectLoading" class="fa fa-spinner fa-spin fa-3x fa-fw" style="font-size:18px; display:none;"></i>
                                </button>
                                <button id="btnResetProject" type="button" class="btn btn-default">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>


@Scripts.Render("~/bundles/jqueryval");
@section Scripts{
    <script src="~/Content/adminlte/components/jquery/dist/jquery.min.js"></script>
    <script src="~/Content/adminlte/components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="~/Content/adminlte/components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Content/adminlte/dist/js/adminlte.min.js"></script>
    <script src="~/Content/adminlte/components/chart.js/Chart.js"></script>

    <script src="~/Content/adminlte/components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/adminlte/components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Content/adminlte/components/select2/dist/js/select2.full.min.js"></script>
    <script src="~/tra-cuu/Scripts/Customer.js"></script>


    <script src="~/Scripts/dhtmlxgantt.js"></script>
    <script src="~/Scripts/resource_construction_materials.js"></script>
    <script src="~/Scripts/GantChart.js"></script>

    <script>
        $(document).ready(function () {
            var txtOwner = $("#Owner").val();
            var txtUserLogin = $("#UserLogin").val();

            if (txtOwner != "" && txtUserLogin != "" && txtOwner == txtUserLogin) {
                gantt.config.readonly = false;
            }
            else {
                gantt.config.readonly = true;
            };
            
            $('#lstUser').select2({
                placeholder: 'Click to add User',
                allowClear: true,
                dropdownAutoHeight: true,
                templateResult: function (idioma) {
                    var iconUrl = $(idioma.element).attr('data-iconurl');
                    var $span = $("<span><img class='img-circle' style='width:40px; height:40px' src='/Content/adminlte/dist/img/" + iconUrl + "'/> " + idioma.text + "</span>");
                    return $span;
                },
                templateSelection: function (idioma) {
                    var iconUrl = $(idioma.element).attr('data-iconurl');
                    var $span = $("<span><img class='img-circle' style='width:30px; height:30px' src='/Content/adminlte/dist/img/" + iconUrl + "'/> " + idioma.text + "</span>");
                    return $span;
                }
            });

            $.ajax({
                url: "/Home/LoadUserListAjax",
                type: "POST",
                dataType: "json",
                success: function (response) {
                    if (response != '') {
                        for (i in response) {
                            $("#lstUser").append("<option value='" + response[i].MA + "' data-iconurl='" + response[i].FILE + "'>" + response[i].TEN + "</option>");
                            $("#lstOwner").append("<option value='" + response[i].MA + "' data-iconurl='" + response[i].FILE + "'>" + response[i].TEN + "</option>");
                        }
                        $("#lstUser").val('').trigger('change');
                        $("#lstOwner").val('').trigger('change');
                    };
                }
            });

            $.ajax({
                url: "/Home/LoadProject/",
                data: {
                    ID: $('#ProjectID').val()
                },
                type: "POST",
                dataType: "json",

                success: function (response) {
                    if (response != '') {
                        if (response.User != null && response.User.trim() != "") {
                            var arrayUser = new Array();
                            arrayUser = response.User.trim().split(',')
                            $("#lstUser").val(arrayUser).trigger('change');
                        }
                        else {
                            $("#lstUser").val(null).trigger('change');
                        }

                        if (response.Owner != null && response.Owner.trim() != "") {
                            $("#lstOwner").val(response.Owner).trigger('change');
                        }
                        else {
                            $("#lstOwner").val(null).trigger('change');
                        }
                    };
                }
            });
        });
    </script>
}